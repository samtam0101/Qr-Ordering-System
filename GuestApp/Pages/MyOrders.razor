@page "/orders/{RestaurantSlug}/{TableCode}"
@inject GuestApp.Services.CartService Cart

<h3>My Orders</h3>

@if (_orders.Count == 0)
{
    <p>No orders yet.</p>
}
else
{
    <ul>
        @foreach (var o in _orders)
        {
            <li>
                <b>#@o.Id</b> — @o.Status — @o.CreatedAt.ToLocalTime().ToString("g")
                <ul>
                    @foreach (var it in (o.Items ?? new()))
                    {
                        <li>@it.Quantity× @it.MenuItem?.Name</li>
                    }
                </ul>
            </li>
        }
    </ul>
}

@code{
    [Parameter] public string? RestaurantSlug { get; set; }
    [Parameter] public string? TableCode { get; set; }
    private List<Infrastructure.Models.Order> _orders = new();

    protected override async Task OnParametersSetAsync()
    {
        await Cart.InitAsync(RestaurantSlug, TableCode);
        _orders = await Cart.GetMyOrdersAsync();
    }
}
